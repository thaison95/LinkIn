(function(){var d=window.jQuery||require("jquery"),g=window._||require("underscore"),m=window.dust||require("dust"),f=LIModules.imports("BaseControl"),q=LIModules.imports("BalloonCallout"),n=LIModules.imports("injectAlert"),r=LIModules.imports("parseQueryString"),s=LIModules.requires("Events"),k={SAVE_SUCCESS:"FREEMIUM_SAVE_SUCCESS",REMOVE_SUCCESS:"FREEMIUM_REMOVE_SUCCESS"},f=f.extend(function(f){var l,t=["#ad-slot-3","#text-ad-container",".textad"],u=["#preview-ctx"],h=LIModules.imports("MediaServerUploader");
return{beforeLoad:function(){!h&&this._config.selfView&&(this._config.dependencies=["scripts/shared/MediaServerUploader"])},afterLoad:function(){this._useDefaultsIfNeeded();this._renderModule()},setImage:function(a){a.url!==this._currentImage.url&&((this._config.originalIsCustomUpload||this._config.isCustomUpload)&&-1!==a.url.indexOf(".jpg")?(this._currentImage.url=a.url,this._$image.attr("src",this._currentImage.url).show()):this._$image.hide())},_preloadImage:function(a){var b=d.Deferred(),c=new Image,
e=this;c.onerror=function(){e._track("image_load_fail",{imageUrl:a});b.resolve(null)};c.onload=function(){b.resolve(c)};c.src=a;return b.promise()},setPosition:function(a){0<a.offsetY&&(a.offsetY=0);this._setMaxOffset();a.offsetY<this._maxOffset&&(a.offsetY=this._maxOffset);a.offsetY!==this._currentImage.offsetY&&(this._currentImage.offsetY=a.offsetY,this._$image.css("top",this._currentImage.offsetY))},_useDefaultsIfNeeded:function(){l=this._config.templateId||"tl/apps/profile/v2/embed/freemium_profile"},
_renderModule:function(){var a=this,b=function(b,e){b||(a._$body=d("body").prepend(e),a._initModule())};this._config.selfView?d.get(this._config.dataUrl).then(function(c){c.content&&(a._content=c.content.TopcardBackground,a._content.csrfToken=r(a._config.saveUrl).csrfToken,g.extend(a._content,a._config.i18n),m.render(l,a._content,b))},function(){a._showError()}):d(function(){m.render(l,a._config,b)})},_initModule:function(){this._originalMediaId=this._mediaId=this._config.mediaId;this._originalOffsetY=
-this._config.imageData.offsetY;this._config.originalIsCustomUpload=this._config.isCustomUpload;this._currentImage={};this._mediaIdSignature=null;this._cacheNodes();this._attachEventListeners();this._imageLoader=null;this._canUpload=!0;this._config.selfView&&this._initUploader();this._resetModule()},_cacheNodes:function(){this._$win=d(window);this._$doc=d(document);this._$wrap=d("#wrapper");this._$el=d("#freemium-bg");this._$image=this._$el.find(".freemium-bg-image");this._$textAd=d(t.join(","));
this._$hiddenOnEditElements=this._$textAd.add(u.join());this._$header=d("#header,#layout-header");this._$responsiveNav=d("#responsive-nav-scrollable,#header-navigation");this._config.isCustomUpload?this._$body.addClass("freemium-bg"):this._config.selfView&&this._config.uploadOnView&&this._$body.addClass("freemium-bg");this._config.selfView&&(this._$profile=d("#body \x3e .wrapper"),this._$uploadForm=this._$el.find(".freemium-bg-upload-form"),this._$uploadInput=this._$el.find(".freemium-bg-upload-input"),
this._$uploadClone=this._$uploadInput.clone(),this._$saveButton=this._$el.find(".freemium-bg-save-button"),this._$cancelButton=this._$el.find(".freemium-bg-cancel-button"),this._$removeButton=this._$el.find(".remove-image"),this._$editButton=this._$el.find(".freemium-bg-edit-button"),this._$changeArea=this._$el.find(".freemium-bg-change-button"),this._$drag=this._$el.find(".freemium-bg-drag-prompt"))},_attachEventListeners:function(){this._$win.on("scroll",this._onWindowScroll);this._config.selfView&&
(this._$el.on("click",".freemium-bg-upload-input",this._uploadClick).on("change",".freemium-bg-upload-input",this._uploadImage),this._$saveButton.on("click",this._saveImage),this._$cancelButton.on("click",this._resetModule),this._$removeButton.on("click",this._removeImage),this._$editButton.on("click",this._editBgClick),this._$uploadForm.on("mpr-upload-error",this._onUploadError).on("mpr-upload-success",this._onUploadSuccess),this._$doc.on("mousedown",this._onBackgroundMouseDown),this._$win.on("resize",
this._setScalingDimension),this._bindProfileEvents())},_bindProfileEvents:function(){g.has(d.fn,"Profile")?(d.fn.Profile.bind(d.fn.Profile.EVENTS.SWITCH_EDIT,this._onProfileEdit),d.fn.Profile.bind(d.fn.Profile.EVENTS.SWITCH_VIEW,this._onProfileView)):setTimeout(g.bind(this._bindProfileEvents,this),25)},_initUploader:function(){h||(h=LIModules.imports("MediaServerUploader"));this._uploader=new h(this._$uploadForm[0])},_uploadClick:function(a){this._track("custom_bg_browse")},_editBgClick:function(a){this._track("custom_bg_edit");
this._setState("edit");this._enableChangeBgUploader();this._$hiddenOnEditElements.hide()},_uploadImage:function(a){var b;if(b=d(a.currentTarget).val()){b=b.substring(b.lastIndexOf(".")+1).toLowerCase();switch(b){case "gif":case "jpg":case "jpeg":case "png":break;default:this._showError(this._config.errors.media);this._track("custom_bg_fail",{failureType:"INV_MEDIA"});return}if(window.File&&window.FileList&&(a=a.target.files[0],b=Math.max(1048576*(this._config.maxUploadSizeInMB||0),6291456),a.size>
b)){this._showError(this._config.errors.size);this._track("custom_bg_fail",{failureType:"SIZE"});return}this._setState("loading");this._$uploadForm.trigger("submit");this._track("custom_bg_open")}else this._track("custom_bg_cancel")},_setMaxOffset:function(){var a=this._$image.height();this._$image.width();var b=this._$el.height(),c=this._config.selfView;this._maxOffset=b-a;0<=this._maxOffset?(this._maxOffset=0,c&&this._$drag.css("display","none")):c&&this._$drag.css("display","")},_setScalingDimension:function(a){if(null!==
a){var b=g.has(a,"width")?a:this._$image[0];a=b.height;var c=this._$el.height(),b=b.width,e=this._$el.width();a/b<c/e?this._$image.addClass("freemium-bg-scale-height"):b<e&&this._$image.removeClass("freemium-bg-scale-height");"edit"===this._state&&this._enableChangeBgUploader();this._setMaxOffset();this._$image.position().top<this._maxOffset&&this.setPosition({offsetY:this._maxOffset})}},_checkImageSize:function(a){var b=383>a.height;(1260>a.width||b)&&n({message:this._config.i18n.i18n_recommended_size,
type:"warning",dismissable:!0,animate:!0})},_removeImage:function(a){this._track("custom_bg_remove");this._syncBackgroundSettings(!0)},_saveImage:function(a){this._track("custom_bg_save");this._syncBackgroundSettings()},_syncBackgroundSettings:function(a){var b=this,c=!0===a,e=!c,p=function(a){"fail"===a.status?(b._showError(),b._track("custom_bg_fail",{failureType:"MUTATOR"}),b._setState("edit")):(b._setState("edit-image"),b._originalMediaId=e?b._mediaId:"",b._originalOffsetY=e?Math.round(b._currentImage.offsetY):
0,b._config.isCustomUpload=e,b._config.originalIsCustomUpload=e,b._disableBgUploader(),b._track("photo_save_success"),s.trigger(c?k.REMOVE_SUCCESS:k.SAVE_SUCCESS),e||b._resetModule())};e||b._config.originalIsCustomUpload?this._mediaId?(this._setState("loading"),e||(b._mediaId=b._config.imageData.defaultImage,b._currentImage.offsetY=0),d.get(b._config.dataUrl).then(function(a){b._content.timestamp=a.content.TopcardBackground.timestamp;b._content.profileVersionTag=a.content.TopcardBackground.profileVersionTag;
b._content.privacySettingsVersionTag=a.content.TopcardBackground.privacySettingsVersionTag}).then(function(){d.ajax(b._config.saveUrl,{type:"POST",headers:{"X-IsAJAXForm":1},data:{bgEnabled:e,mediaID:e?b._mediaId:"",signature:e?b._mediaIdSignature:null,isCustomImage:e,yPos:b._currentImage.offsetY?Math.round(-b._currentImage.offsetY):0,timestamp:b._content.timestamp,changeCount:b._content.changeCount,locale:b._content.locale,profileVersionTag:b._content.profileVersionTag,privacySettingsVersionTag:b._content.privacySettingsVersionTag}}).then(p)})):
(this._track("custom_bg_fail",{failureType:"NULL_MEDIA"}),this._showError()):p({status:"okay"})},_showError:function(a){n({message:a||this._config.errors.defaultErr,type:"error",dismissable:!0,animate:!0})},_resetModule:function(){var a=this,b=this._getMediaUrl(this._originalMediaId),c;this._$hiddenOnEditElements.show();this._config.isCustomUpload=this._config.originalIsCustomUpload;this._config.selfView&&((c=((c=this._isInEditMode())||this._displayUploadOnView())&&this._config.showUploader)?(this._onProfileEdit(),
this._disableBgUploader(),this._config.isCustomUpload?this._setState("edit-image"):(this._setState("upload"),this._enableAddBgUploader())):this._onProfileView());this._config.originalIsCustomUpload&&this._preloadImage(b).then(function(c){a._setScalingDimension(c);a.setImage({url:b});a.setPosition({offsetY:a._originalOffsetY})})},_onUploadError:function(a,b){var c,e={failureType:b.error||"generic",uploadedFilename:this._getUploadedFileName()},d=this;switch(b.error){case "SIZE":c=this._config.errors.size;
break;case "INV_MEDIA":c=this._config.errors.media;break;case "DIMENSION":c=this._config.errors.dimension;break;case "TIME":if(this._canUpload){this._canUpload=!1;e.failureType="TIME_RETRY";this._track("custom_bg_fail",e);this._refreshHashInfo().then(function(){d._$uploadForm.trigger("submit")});return}}this._canUpload=!0;this._track("custom_bg_fail",e);this._showError(c);this._resetUploadInput();this._setState(this._lastState)},_refreshHashInfo:function(){var a=this._$el.find('[name\x3d"upload_info"]');
return d.get(this._config.dataUrl).then(function(b){a.val(b.content.TopcardBackground.hashInfoJS)})},_onUploadSuccess:function(a,b){var c=this._getMediaUrl(b.value),e=this._getUploadedFileName(),d=this;this._canUpload=!0;this._resetUploadInput();this._mediaId=b.value;b.sig&&(this._mediaIdSignature=b.sig);this._preloadImage(c).then(function(a){d._config.isCustomUpload=!0;d._setScalingDimension(a);d.setImage({url:c});d.setPosition({offsetY:0});d._setState("edit");d._checkImageSize(a);d._enableChangeBgUploader();
d._track("photo_upload_success",{returnedFilename:encodeURIComponent(c),uploadedFilename:e})})},_onBackgroundMouseDown:function(a){var b=this._$el.position().top,c=this._$el.outerHeight(!0),b=a.pageY>=b&&a.pageY<=b+c;if("edit"===this._state&&b)return this._maxOffset||this._setMaxOffset(),this._$doc.one("mouseup",this._onBackgroundMouseUp).on("mousemove",this._onBackgroundMouseMove),this._currentTracker=this._createMouseTracker(a.pageY,this._currentImage.offsetY||0),a.preventDefault(),!1},_onBackgroundMouseUp:function(a){this._$doc.off("mousemove",
this._onBackgroundMouseMove)},_onBackgroundMouseMove:function(a){a.preventDefault();this.setPosition({offsetY:this._currentTracker(a.pageY)})},_onUploadMouseMove:function(a){var b=this._$uploadInput,c=this._$header,d=0;this._$textAd.length?c=this._$textAd:this._$responsiveNav.length&&(c=this._$responsiveNav);d=c.offset().top+c.outerHeight(!0);a.pageY<d||this._intersectRect(a.pageX,a.pageY,this._$profile)||(this._handleCallout(a),b.offset({left:a.pageX-b.width()/2,top:a.pageY-b.height()/2}))},_onWindowScroll:function(){var a;
a=this._$el[0].getBoundingClientRect();0<a.top+a.height&&(a=this._$win.scrollTop()/2,this._$image.css({transform:"translateY("+a+"px)","-moz-transform":"translateY("+a+"px)","-webkit-transform":"translateY("+a+"px)"}))},_onProfileEdit:function(){this._config.showUploader&&(this._config.isCustomUpload?(this._setState("edit-image"),this._disableBgUploader()):(this._setState("upload"),this._enableAddBgUploader(),this._track("custom_bg_impr")),this._$body.removeClass("freemium-bg-view").addClass("freemium-bg"))},
_onProfileView:function(){this._disableBgUploader();this._config.isCustomUpload||this._config.uploadOnView?!this._config.isCustomUpload&&this._config.uploadOnView?(this._setState("upload"),this._enableAddBgUploader()):this._$body.addClass("freemium-bg-view"):(this._$body.removeClass("freemium-bg"),this._setState("view"))},_setState:function(a){this._lastState=this._state;this._state=a;this._$el.attr("class","");this._$el.addClass("freemium-bg-state-"+a);"edit"===a?this._$hiddenOnEditElements.hide():
this._$hiddenOnEditElements.show()},_createMouseTracker:function(a,b){return function(c){return b+c-a}},_getMediaUrl:function(a){return 0===a.indexOf("http")?a:this._config.mediaRoot.replace("mediaId",a)},_track:function(a,b){b=b||{};b.locale=this._content.locale||"na";var c=this._isInEditMode()?"profile_edit_":"profile_view_";WebTracking.trackUserAction(c+a,b)},_isInEditMode:function(){return this._$wrap.hasClass("edit-my-profile")},_enableChangeBgUploader:function(){this._$changeArea.offset();this._$el.offset();
this._$doc.off("mousemove");this._$uploadInput.removeClass("hover-mode").addClass("disabled")},_enableAddBgUploader:function(){this._initCallout();this._$uploadInput.removeClass("disabled").addClass("hover-mode");this._$doc.on("mousemove",this._onUploadMouseMove)},_disableBgUploader:function(){this._$doc.off("mousemove");this._$uploadInput.removeClass("hover-mode").addClass("disabled")},_resetUploadInput:function(){this._$uploadInput.replaceWith(this._$uploadClone.clone());this._$uploadInput=this._$el.find(".freemium-bg-upload-input")},
_intersectRect:function(a,b,c){if(!c)return!1;var d=c.offset();return a>=d.left&&a<=d.left+c.outerWidth(!0)&&b>=d.top&&b<=d.top+c.outerHeight(!0)},_initCallout:function(){this._$info||(this._$info=this._$el.find(".info"),this._callout=new q(this._$info.get(0),{id:this._$info.data("li-tooltip-id"),orientation:"top",width:"auto",type:"hovercard-callout"}))},_handleCallout:function(a){a=this._intersectRect(a.pageX,a.pageY,this._$info);!this._calloutEngaged&&a?(this._calloutEngaged=!0,this._callout.open(),
this._track("custom_bg_info")):!a&&this._calloutEngaged&&(this._calloutEngaged=!1,this._callout.close())},_displayUploadOnView:function(){return this._config.uploadOnView&&!this._config.isCustomUpload},_getUploadedFileName:function(){var a=this._$uploadInput.val().split(/(\\|\/)/g);return a?encodeURIComponent(a.pop()):null}}});f.EVENTS_API=k;LIModules.exports("FreemiumBg",f)})(window.require);(function(){function c(b,a){return b.write('\x3cinput type\x3d"file" accept\x3d"image/jpeg, image/jpg, image/png, image/gif" name\x3d"').reference(a.get(["name"],!1),a,"h").write('"').exists(a.get(["className"],!1),a,{block:d},null).exists(a.get(["id"],!1),a,{block:e},null).write("/\x3e")}function d(b,a){return b.write('class\x3d"').reference(a.get(["className"],!1),a,"h").write('"')}function e(b,a){return b.write('id\x3d"').reference(a.get(["id"],!1),a,"h").write('"')}dust.register("tl/shared/inputs/inputFileImage",
c);return c})();(function(){dust.register("inputFileImage",dust.cache["tl/shared/inputs/inputFileImage"])})();(function(){function c(b,a){return b.write('\x3cdiv id\x3d"freemium-bg"\x3e').exists(a.get(["selfView"],!1),a,{block:d},null).write('\x3cdiv class\x3d"freemium-bg-images"\x3e\x3cimg class\x3d"freemium-bg-image" src\x3d"" alt\x3d"image"/\x3e\x3c/div\x3e').exists(a.get(["selfView"],!1),a,{block:e},null).write("\x3c/div\x3e")}function d(b,a){return b.write('\x3cform class\x3d"freemium-bg-upload-form" action\x3d"').reference(a.get(["link_media_upload"],!1),a,"h").write('" method\x3d"POST" enctype\x3d"multipart/form-data"\x3e').partial("tl/shared/inputs/inputFileImage",
a,{name:"file",className:"freemium-bg-upload-input",id:"backgroundImageFile"}).write('\x3cinput type\x3d"hidden" name\x3d"upload_info" value\x3d"').reference(a.get(["hashInfoJS"],!1),a,"h").write('"/\x3e\x3cinput type\x3d"hidden" name\x3d"persist" value\x3d"true"/\x3e\x3cinput type\x3d"hidden" name\x3d"csrfToken" value\x3d"').reference(a.get(["csrfToken"],!1),a,"h").write('"/\x3e').helper("eq",a,{block:f},{key:a.get(["lix_sign_response_enabled"],!1),value:"enabled"}).write("\x3c/form\x3e")}function f(b,
a){return b.write('\x3cinput type\x3d"hidden" name\x3d"sign_response" value\x3d"true" /\x3e')}function e(b,a){return b.write('\x3cdiv class\x3d"freemium-bg-controls"\x3e\x3cdiv class\x3d"freemium-bg-controls-edit"\x3e\x3cbutton class\x3d"freemium-bg-cancel-button" title\x3d"').reference(a.get(["i18n_cancel"],!1),a,"h").write('" type\x3d"button"\x3e\x3c/button\x3e\x3cbutton class\x3d"remove-image" type\x3d"button"\x3e').reference(a.get(["i18n_remove"],!1),a,"h").write('\x3c/button\x3e\x3clabel class\x3d"freemium-bg-change-button" for\x3d"backgroundImageFile"\x3e').reference(a.get(["i18n_change"],
!1),a,"h").write('\x3c/label\x3e\x3cbutton class\x3d"freemium-bg-save-button" type\x3d"button"\x3e').reference(a.get(["i18n_save"],!1),a,"h").write('\x3c/button\x3e\x3c/div\x3e\x3cdiv class\x3d"freemium-bg-drag-prompt"\x3e').reference(a.get(["i18n_drag_to_position"],!1),a,"h").write('\x3c/div\x3e\x3cdiv class\x3d"freemium-bg-upload-button"\x3e\x3cp class\x3d"freemium-bg-upload-button-text"\x3e\x3cstrong\x3e').reference(a.get(["i18n_add_background"],!1),a,"h").write("\x3c/strong\x3e").reference(a.get(["i18n_add_suggestion"],
!1),a,"h").write('\x3cspan class\x3d"help"\x3e').reference(a.get(["i18n_recommended_size"],!1),a,"h").write(' \x3ci class\x3d"info" data-li-tooltip-id\x3d"freemium-image-specs"\x3e\x3c/i\x3e\x3c/span\x3e\x3cdiv id\x3d"freemium-image-specs" class\x3d"callout-container"\x3e\x3cdiv class\x3d"callout-content"\x3e\x3cdiv class\x3d"callout-body"\x3e\x3cp\x3e').reference(a.get(["i18n_image_specs"],!1),a,"h").write('\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/p\x3e\x3c/div\x3e\x3cbutton class\x3d"freemium-bg-edit-button" type\x3d"button"\x3e').reference(a.get(["i18n_edit_background"],
!1),a,"h").write('\x3c/button\x3e\x3c/div\x3e\x3cdiv class\x3d"freemium-bg-spinner"\x3e\x3c/div\x3e')}dust.register("tl/apps/profile/v2/embed/freemium_profile",c);return c})();(function(){dust.register("freemium_profile",dust.cache["tl/apps/profile/v2/embed/freemium_profile"])})();(function(){function c(b,a){return b.write('\x3cdiv id\x3d"premium-image-container" tabindex\x3d"0" class\x3d"is-focusable"\x3e').exists(a.get(["ieLTE8"],!1),a,{"else":d,block:e},null).exists(a.get(["isSelfView"],!1),a,{block:f},null).notexists(a.get(["ieLTE8"],!1),a,{block:g},null).write('\x3cdiv id\x3d"premium-image-shadow"\x3e\x3c/div\x3e\x3c/div\x3e')}function d(b,a){return b.write('\x3cdiv id\x3d"premium-image"').exists(a.get(["ie10"],!1),a,{block:h},null).write("\x3e")}function h(b,a){return b.write(' class\x3d"ie10"')}
function e(b,a){return b.write('\x3cimg id\x3d"premium-image" class\x3d"inline-img" src\x3d"" /\x3e')}function f(b,a){return b.write('\x3cbutton type\x3d"button" id\x3d"edit-background-control" class\x3d"hidden"\x3e\x3cspan class\x3d"glyph" aria-hidden\x3d"true"\x3e\x3c/span\x3e\x3cspan class\x3d"copy"\x3e').reference(a.getPath(!1,["i18n","editBgBtn"]),a,"h",["et","s"]).write('\x3c/span\x3e\x3c/button\x3e\x3cbutton type\x3d"button" id\x3d"edit-promo-control" class\x3d"hidden"\x3e\x3cdiv class\x3d"copy"\x3e\x3cspan class\x3d"glyph" aria-hidden\x3d"true"\x3e\x3c/span\x3e\x3ch3\x3e').reference(a.getPath(!1,
["i18n","editPromoBtnHeader"]),a,"h",["et","s"]).write("\x3c/h3\x3e\x3cp\x3e").reference(a.getPath(!1,["i18n","editPromoBtnSubhead"]),a,"h",["et","s"]).write('\x3c/p\x3e\x3c/div\x3e\x3c/button\x3e\x3cdiv id\x3d"reposition-background-control" class\x3d"hidden" tabindex\x3d"0"\x3e\x3cspan class\x3d"copy"\x3e').reference(a.getPath(!1,["i18n","repositionBgBtn"]),a,"h",["mk","s"]).write('\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"loader-control" class\x3d"hidden"\x3e\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e\x3c/div\x3e')}
function g(b,a){return b.write("\x3c/div\x3e")}dust.register("tl/apps/profile/v2/embed/premium/premium_image_node",c);return c})();(function(){dust.register("premium_image_node",dust.cache["tl/apps/profile/v2/embed/premium/premium_image_node"])})();(function(){function b(b,a){return b.write('\x3cstyle type\x3d"text/css" id\x3d"').reference(a.get(["tagId"],!1),a,"h").write('"\x3e@media screen and (min-width: ').reference(a.get(["minWidth"],!1),a,"h").write("px) {#").reference(a.get(["imageId"],!1),a,"h").write(" {background-size: cover !important;}}\x3c/style\x3e")}dust.register("tl/apps/profile/v2/embed/premium/premium_image_media_query",b);return b})();(function(){dust.register("premium_image_media_query",dust.cache["tl/apps/profile/v2/embed/premium/premium_image_media_query"])})();LI.define("PictureHandlerConfig");
LI.PictureHandlerConfig={fullStretchShell:{ELEM_ID:"full-stretch-header",SELECTOR_INSERT_BEFORE:"#body"},premiumNode:{ELEM_ID:"topcard-background",TEMPLATE:"tl/apps/profile/v2/embed/premium/premium_image_node"},premiumImageContainer:{ELEM_ID:"premium-image-container",CLASS_EDIT_MODE:"edit-mode",CLASS_REPOSITION_MODE:"reposition-mode"},premiumImage:{ELEM_ID:"premium-image",EDIT_BG_CONTROL_ID:"edit-background-control",PROMO_EDIT_CONTROL_ID:"edit-promo-control",REPOSITION_BG_CONTROL_ID:"reposition-background-control",LOADING_CONTROL_ID:"loader-control",
CONTROL_CLASS_HIDDEN:"hidden",minScrollWidth:974,containerHeight:404,ADDL_BUFFER_FOR_MIN_WIDTH:16,offsetUnits:"px",parallaxMultiplier:0.5,RECOMMENDED_MIN_WIDTH:1260,RECOMMENDED_MIN_HEIGHT:383,reverseDirectionAdjustment:!0,KEY_POSITION_MULTIPLIER:10},premiumImageStyles:{ELEM_ID:"premium-profile-media-query",TEMPLATE:"tl/apps/profile/v2/embed/premium/premium_image_media_query"},upsell:{ELEM_CLASS:"premium-upsell",TEMPLATE:"tl/apps/profile/v2/embed/premium/premium_upsell_node",IMPRESSION_CODE:"topCardBackgroundPromo",
DATA_PATH:"/profile/premium-upsell-dialog",animation:{customClassName:"animate",delay:1E3},action:{promoCTAClassName:"upsell-btn"},dialog:{customClassName:"premium-upsell-dialog",decorators:["scripts/shared/Dialog/AjaxDustTemplateLoading"],template:"tl/apps/profile/v2/embed/premium/premium_upsell_dialog",width:600}},profilePageHooks:{SELECTOR_WRAPPER:"#wrapper",CLASS_EDIT_MODE:"edit-my-profile",SELECTOR_DONE_EDITING_BTNS:".profile-actions.edit-actions",STYLES_HIDE_BTNS:{opacity:"0",visibility:"hidden"},
STYLES_SHOW_BTNS:{opacity:"1",visibility:"visible"},SELECTOR_FOCUSON_AFTER_REPOSITION:"#bg-photo-editor .edit-panel .save"},EVENTS:{CLICK:"click",SCROLL:"scroll",RESIZE:"resize",MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",KEYDOWN:"keydown",KEYUP:"keyup",WINDOW_RESIZE_DELAY:25,KEYCODES:{UP_ARROW:38,DOWN_ARROW:40,ENTER_KEY:13}},MODULE_STATES:{VIEW:0,EDIT:1,REPOSITION:2,LOADING:3,EDIT_LOCKED:4},IE_LTE8:LI.browser.ie8||LI.browser.ie7,IE_10:LI.browser.ie10,PARAM_AUTO_OPEN:"editBackground",
CLASS_HAS_FULL_HEADER:"has-full-stretch-header"};(function(e){var d=window.jQuery||e("jquery"),g=window._||e("underscore"),k=window.dust||e("dust");e=LIModules.imports("BaseControl");var b=LIModules.imports("PictureHandlerConfig"),m=LIModules.imports("ModalDialogBox"),p=LIModules.imports("injectAlert"),q=LIModules.imports("addParams");e=e.extend(function(e){var f=d(window);return{moduleState:0,beforeInit:function(){d("body").hasClass(b.CLASS_HAS_FULL_HEADER)&&(this.alreadyInstantiated=!0)},beforeDecoration:function(){if(!this.alreadyInstantiated){if(!b)return this._renderError(),
!1;g.extend(b,this._config);this._config.premiumImage=g.defaults({},this._config.imageData,{isSelfView:this._config.isSelfView,ieLTE8:b.IE_LTE8,ie10:b.IE_10});this._config.premiumImage.i18n=this._config.i18n}},afterDecoration:function(){var a=this,c="enabled"===this._config.lazyLoad;this.alreadyInstantiated||(d(b.fullStretchShell.SELECTOR_INSERT_BEFORE).before('\x3cdiv id\x3d"'+b.fullStretchShell.ELEM_ID+'"\x3e\x3cdiv id\x3d"'+b.premiumNode.ELEM_ID+'"\x3e\x3c/div\x3e\x3c/div\x3e'),this._$el=d("#"+
b.premiumNode.ELEM_ID),this._el={},this.renderModule(),this._el.$premiumImageContainer=d("#"+b.premiumImageContainer.ELEM_ID),this._el.$premiumImage=d("#"+b.premiumImage.ELEM_ID),c||this._setBackgroundImage(),d(window).load(function(){c&&a._setBackgroundImage();a._config.showPromo&&(m?a.renderUpsell():a.loadDependencies(["scripts/shared/Dialog"]).then(a.renderUpsell))}))},attachEventListeners:function(){var a=this;this.alreadyInstantiated||(this._attachParallaxEventListeners(),b.IE_LTE8&&(a._el.$premiumImage.on("dragstart",
function(a){a.preventDefault()}),f.on(b.EVENTS.RESIZE,g.debounce(function(){f.width()>a._config.premiumImage.width?a._simulateCover():b.premiumImage.containerHeight>a._config.premiumImage.height?a._el.$premiumImage.css("width","auto").css("height","100%"):a._el.$premiumImage.css("width","auto").css("height","auto")},b.EVENTS.WINDOW_RESIZE_DELAY))))},lockParallax:function(){this._disableViewMode();this.moduleState=b.MODULE_STATES.EDIT_LOCKED},unlockParallax:function(){this._initViewMode()},_initViewMode:function(){this._attachParallaxEventListeners();
this.moduleState=b.MODULE_STATES.VIEW},_disableViewMode:function(){this._removeParallaxEventListeners()},renderModule:function(){var a=this;this.alreadyInstantiated||k.render(b.premiumNode.TEMPLATE,this._config.premiumImage,function(c,h){c&&a._renderError();a._$el.html(h);d("body").addClass(b.CLASS_HAS_FULL_HEADER)})},_setBackgroundImage:function(a){var c=b.premiumImageStyles;"string"===typeof a&&(this._config.premiumImage.url=a);return this._prefetchAndGetDimensions().then(g.bind(function(){b.IE_LTE8||
(d("#"+c.ELEM_ID).remove(),k.render(c.TEMPLATE,{tagId:c.ELEM_ID,imageId:b.premiumImage.ELEM_ID,minWidth:this._config.premiumImage.width+b.premiumImage.ADDL_BUFFER_FOR_MIN_WIDTH},function(a,b){a||d("head").append(b)}));b.IE_LTE8?this._el.$premiumImage.attr("src",this._config.premiumImage.url):this._el.$premiumImage.css("background-image",'url("'+this._config.premiumImage.url+'")');this._setPremiumImageOffsets(this._config.premiumImage.offsetY);this._el.$premiumImage.css("min-width",b.premiumImage.minScrollWidth);
f.width()>this._config.premiumImage.width&&b.IE_LTE8?this._el.$premiumImage.css("width","100%").css("height","auto"):b.premiumImage.containerHeight>this._config.premiumImage.height?b.IE_LTE8?this._el.$premiumImage.css("width","auto").css("height","100%"):this._el.$premiumImage.css("background-size","auto 100%"):b.IE_LTE8?this._el.$premiumImage.css("width","auto").css("height","auto"):this._config.premiumImage.width<b.premiumImage.minScrollWidth?this._el.$premiumImage.css("background-size","cover"):
this._el.$premiumImage.css("background-size","auto")},this))},_prefetchAndGetDimensions:function(){var a=new Image,b=d.Deferred(),h=this;a.onload=function(){h._config.premiumImage.width=a.width;h._config.premiumImage.height=a.height;b.resolve()};a.onerror=function(){b.reject()};a.src=this._config.premiumImage.url;return b},renderUpsell:function(){var a=this._config,c=b.upsell,h=a.viewerId,e=a.vieweeId,a=q(c.DATA_PATH,{id:h,vieweeId:e,authType:a.authType||"",authToken:a.authToken||"",locale:a.locale||
""});d.get(a,g.bind(function(a){k.render(c.TEMPLATE,a,g.bind(function(d,f){var l=c.dialog,k=c.animation,n=this._el.$premiumImageContainer;d||(n.append(f),this._el.$upSell=n.find("."+b.upsell.ELEM_CLASS),this._attachUpsellEventListeners(),this._dialog=new m("",{title:a.content.UpsellDialog.i18n_dialog_title,width:l.width,customClassName:l.customClassName,decorators:l.decorators,dustContentTemplate:l.template,dustContentTemplateData:a}),setTimeout(g.bind(function(){var a={attributes:{viewerId:h.toString(),
vieweeId:e.toString()},impression_position:1,impression_version:1};this._el.$upSell.addClass(k.customClassName);WebTracking.trackUserImpression(c.IMPRESSION_CODE,JSON.stringify(a),!0)},this),k.delay))},this))},this))},_upsellCTAHandler:function(a){a.preventDefault();this._dialog.open()},_attachUpsellEventListeners:function(){this._el.$upSell.on(b.EVENTS.CLICK,"."+b.upsell.action.promoCTAClassName,this._upsellCTAHandler)},_premiumImageParallaxScrollHandler:function(){var a=f.scrollTop();this._el.$premiumImage.css("top",
(0>a?0:a)*b.premiumImage.parallaxMultiplier+b.premiumImage.offsetUnits)},_attachParallaxEventListeners:function(){f.on(b.EVENTS.SCROLL,this._premiumImageParallaxScrollHandler);this._premiumImageParallaxScrollHandler()},_removeParallaxEventListeners:function(){f.off(b.EVENTS.SCROLL,this._premiumImageParallaxScrollHandler);this._el.$premiumImage.css("top","0")},_getPremiumImageOffsets:function(){var a=b.IE_LTE8?d.trim(this._el.$premiumImage.css("left")+" "+this._el.$premiumImage.css("top")):d.trim(this._el.$premiumImage.css("background-position")),
c=null;a&&(a=a.split(" "),c=[d.trim(a[0]),d.trim(a[1])]);return c},_setPremiumImageOffsets:function(a){var c;a instanceof Array?(c=this._translatePremiumImageOffset(a[0]),a=this._translatePremiumImageOffset(a[1])):(c=b.IE_LTE8?"0":"center",a=this._translatePremiumImageOffset(a));d(".multiply:not(.premium-profile)").length&&(a=this._adjustFreemiumImageYPos(a));b.IE_LTE8?this._el.$premiumImage.css("left",c).css("top",a):this._el.$premiumImage.css("background-position",c+" "+a)},_translatePremiumImageOffset:function(a){var c=
a;a instanceof String?(a=parseInt(a,10))&&(c=-1*Math.abs(a)+b.premiumImage.offsetUnits):"number"===typeof a&&(c=-1*Math.abs(a)+b.premiumImage.offsetUnits);return c},_adjustFreemiumImageYPos:function(a){var c=parseInt(a,10);c&&(c=this._config.premiumImage.height+c,c<b.premiumImage.containerHeight&&(a=this._config.premiumImage.height-b.premiumImage.containerHeight,a=this._translatePremiumImageOffset(a)));return a},_getPremiumImageHeightMultiplier:function(a){var c=a||f.width(),d=this._config.premiumImage.width,
e=1;b.IE_LTE8&&!a?(a=new Image,a.src=this._el.$premiumImage.attr("src"),d=a.width,e=c/d):d<c&&(e=c/d);return e},_getAdjustedPremiumImageHeight:function(){return this._config.premiumImage.height*this._getPremiumImageHeightMultiplier()},_simulateCover:function(){var a=f.width(),c=this._config.premiumImage.width,d=this._config.premiumImage.height;a/c*d<b.premiumImage.containerHeight?(a=c*b.premiumImage.containerHeight/d,this._el.$premiumImage.css("width",a+"px").css("height","auto")):this._el.$premiumImage.css("width",
"100%").css("height","auto")},_renderError:function(a){a&&p(a||this._config.i18n.errorMsg)}}});LIModules.exports("PictureHandler",e)})(window.require);!function(a){function b(){this.nodes={},this.requests={},n.addListener(a,i,n.bind(this.receiveMessage,this))}function c(b){var c,e=n.getQueryParams();b=b||{},c=b.remote,this.channel=b.channel||e[l]||"e_"+(new Date).getTime(),this.container=c?new d(this.channel,c,b.container):null,c||(this.remoteWindow=a.parent),this.remoteOrigin=this._getRemoteOrigin(c)||e[k],this.methods=b.methods||{},this.methods[j]=this._buildReady(b.ready),this.container||this._sendDiscovery()}function d(b,c,d){var e=a.document,f=this.el=e.createElement("iframe");c&&c.match(m)&&(f.name=f.id=b,f.src=this.buildFrameSrc(c),d?this.setAttributes(d):(this.setDefaults(),e.getElementsByTagName("body")[0].appendChild(f)))}function e(a,b,c){var d={method:a};b&&(d.params=b),c||(this.id=d.id=this._generateId()),this.payload=d}function f(a){function c(b){function c(a){return function(){var b=g.addRequest(a,[].slice.call(arguments));return d.send(b.payload),b}}for(var f=b.length;f--;)e[b[f]]=c(b[f]);a.methods&&d.container&&d._sendDiscovery()}var d,e=this,f=a.ready;g||(g=new b),f?a.ready=function(a){c(a),f()}:a.ready=c,d=g.addNode(a),this.$destroy=function(){g.removeNode(d)},this.$container=function(){return d.container&&d.container.el},this.VERSION="0.3.1"}var g,h="2.0",i="message",j="rpc.discover",k="e_origin",l="e_channel",m=/^https?:\/\//,n={bind:function(a,b){return function(){a.apply(b,arguments)}},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},getQueryParams:function(){function b(a){return a.replace(/[\x00'"<\\]/g,"ï¿½")}for(var c,d,e=a.location.search.slice(1).split("&"),f={};e.length;)d=e.pop(),d&&(c=d.split("="),c.length>1&&(f[decodeURIComponent(c[0])]=b(decodeURIComponent(c[1]))));return f}};a.addEventListener?n.addListener=function(a,b,c){a.addEventListener(b,c,!1)}:a.attachEvent&&(n.addListener=function(a,b,c){a.attachEvent("on"+b,c)}),b.prototype={addNode:function(a){var b=new c(a);return this.nodes[b.channel]=b,b},addRequest:function(a,b){var c=new e(a,b);return this.requests[c.id]=c,c},removeNode:function(a){delete this.nodes[a.channel],a.destroy()},_parseJSONMessage:function(a){try{return JSON.parse(a)}catch(b){return null}},receiveMessage:function(a){var b,c;b=this._parseJSONMessage(a.data),b&&(c=this.nodes[b.channel],c&&a.origin===c.remoteOrigin&&(b.method?this.processMessage(c,b):(this.requests[b.id].process(b),delete this.requests[b.id])))},processMessage:function(a,b){var c,d=a.methods[b.method],e=a.buildCallback(this._buildResultPayload,b.id),f=a.buildCallback(this._buildErrorPayload,b.id),g=b.params;g=n.isArray(g)?g:[g],c=d.apply(a,g.concat(e,f)),c&&e(c)},_buildResultPayload:function(a,b){return{result:a,id:b}},_buildErrorPayload:function(a,b){return{error:{code:-32099,message:a},id:b}}},c.prototype={send:function(b){var c=this;b.jsonrpc=h,b.channel=c.channel,a.setTimeout(function(){c.remoteWindow.postMessage(JSON.stringify(b),c.remoteOrigin)},10)},destroy:function(){this.container&&(this.container.destroy(),this.container=null)},buildCallback:function(a,b){var c=this;return function(){c.send(a(arguments[0],b))}},_buildReady:function(a){var b=this;return function(){var c=b.container,d=c&&c.el;return b.remoteWindow||!c||(b.remoteWindow=d.contentWindow,b.remoteWindow)?void a.apply(b,arguments):void n.addListener(d,"load",function(){b.remoteWindow=d.contentWindow,a.apply(b,arguments)})}},_sendDiscovery:function(){var a=new e(j,[this._getMethodNames()],!0);this.send(a.payload)},_getMethodNames:function(){var a,b=this.methods,c=[];for(a in b)c.push(a);return c},_getRemoteOrigin:function(a){var b;return a&&"string"==typeof a?(b=a.split("/"),b[0]+"//"+b[2]):""}},d.prototype={destroy:function(){var a=this.el;a&&a.parentNode&&a.parentNode.removeChild(a),this.el=null},setAttributes:function(a){var b,c=this.el;for(b in a)"style"===b?c.style.cssText=a[b]:c[b]=a[b]},setDefaults:function(){var a=this.el.style;a.visibility="hidden",a.width="1px",a.height="1px",a.position="absolute",a.left="-999px",a.top="0"},buildFrameSrc:function(b){var c=a.location,d=c.origin?c.origin:c.protocol+"//"+c.host,e=k+"="+d,f=b.split("#"),g=f[0].split("?");return b=(g[1]?g.join("?")+"&":g[0]+"?")+e,b+="&"+l+"="+this.el.id,f[1]&&(b+="#"+f[1]),b}},e.prototype={process:function(a){a.result&&this._resultCallback?this._resultCallback(a.result):a.error&&this._errorCallback&&this._errorCallback(a.error)},result:function(a){return this._resultCallback=a,this},error:function(a){return this._errorCallback=a,this},_generateId:function(){var a=0;return function(){return++a}}()},a.Espany=f}(window);